groups:
  - name: "Prometheus self-monitoring"
    rules:
      - alert: "PrometheusTargetMissing"
        expr: up == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Prometheus target missing (instance {{ $labels.instance }})"
          description: "A Prometheus target has disappeared. An exporter might be crashed.\nValue: {{ $value }}\nLabels: {{ $labels }}"
          fingerprint: "Prometheus (Instance: {{ $labels.instance }})"

  - name: "NodeExporter rules"
    rules:
      - alert: "Memory usage"
        expr: floor(node_memory_MemFree_bytes / 1024 / 1024) < 1024
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Available memory is {{ $value | humanize }} MB"
          description: "Available memory of {{ $labels.instance }} is {{ $value | humanize }} MB"
          fingerprint: "NodeExporter (Instance: {{ $labels.instance }})"

      - alert: "Memory usage"
        expr: floor(node_memory_MemFree_bytes / 1024 / 1024) < 512
        for: 5m
        labels:
          severity: error
        annotations:
          summary: "Available memory is {{ $value | humanize }} MB"
          description: "Available memory of {{ $labels.instance }} is {{ $value | humanize }} MB"
          fingerprint: "NodeExporter (Instance: {{ $labels.instance }})"

      - alert: "Disk usage"
        expr: floor(node_filesystem_free_bytes{fstype="ext4"} / 1024 / 1024) < 4096
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Available disk space is {{ $value | humanize }} MB"
          description: "Available disk space of {{ $labels.mountpoint }} is {{ $value | humanize }} MB"
          fingerprint: "NodeExporter (Instance: {{ $labels.instance }}) (Disk: {{ $labels.mountpoint }})"

      - alert: "Disk usage"
        expr: floor(node_filesystem_free_bytes{fstype="ext4"} / 1024 / 1024) < 2048
        for: 5m
        labels:
          severity: error
        annotations:
          summary: "Available disk space is {{ $value | humanize }} MB"
          description: "Available disk space of {{ $labels.mountpoint }} is {{ $value | humanize }} MB"
          fingerprint: "NodeExporter (Instance: {{ $labels.instance }}) (Disk: {{ $labels.mountpoint }})"
