version: "3.8"
services:
  grafana-agent:
    image: "grafana/agent:v0.21.1"
    container_name: "grafana-agent"
    network_mode: "bridge"
    volumes:
      - "$PWD/grafana-agent-conf/config.yaml:/etc/agent/agent.yaml"
      - "$PWD/grafana-agent-data:/etc/agent/data:rw"
    ports:
      - "8080:80/tcp"
      - "9095:9095/tcp"

  grafana-sm-agent:
    image: "grafana/synthetic-monitoring-agent:v0.4.1-0-g49cdae8"
    container_name: "grafana-sm-agent"
    network_mode: "bridge"
    depends_on:
      - "grafana-agent"
    environment:
    # - "API_TOKEN="
      - "API_SERVER=172.17.0.2:9095"
    command:
      - "--api-server-address=${API_SERVER}"
    # - "--api-token=${API_TOKEN}"
      - "--verbose=true"
    ports:
      - "4050:4050/tcp"
