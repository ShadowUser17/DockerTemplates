networks:
  core_network:
    name: "core_network"
    ipam:
      config:
        - subnet: "172.30.0.0/23"
          ip_range: "172.30.0.0/23"
          gateway: "172.30.1.254"

services:
  traefik:
    image: "traefik:v2.11.0"
    restart: "always"
    container_name: "traefik.docker.localhost"
    deploy:
      resources:
        limits:
          memory: "60M"
        reservations:
          memory: "30M"
    networks:
      core_network:
        ipv4_address: "172.30.1.252"
    volumes:
      - "$PWD/traefik:/etc/traefik:ro"
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
    ports:
      - "80:80/tcp"
      - "9090:9090/tcp"

  coredns:
    image: "coredns/coredns:1.11.1"
    container_name: "coredns.docker.localhost"
    restart: "always"
    deploy:
      resources:
        limits:
          memory: "40M"
        reservations:
          memory: "20M"
    command:
      - "-conf=/etc/coredns/Corefile"
    volumes:
      - "$PWD/coredns:/etc/coredns:ro"
    networks:
      core_network:
        ipv4_address: "172.30.1.253"
    expose:
      - "9153:9153/tcp"
      - "5300:5300/udp"

  # watchtower:
  #   restart: "always"
  #   image: "containrrr/watchtower:1.7.1"
  #   container_name: "watchtower.docker.localhost"
  #   command:
  #     - "--interval=3600"
  #   volumes:
  #     - "/var/run/docker.sock:/var/run/docker.sock:ro"
  #   networks:
  #     core_network:
  #       ipv4_address: "172.30.1.251"
