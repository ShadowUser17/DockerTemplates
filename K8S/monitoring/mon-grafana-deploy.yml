apiVersion: "apps/v1"
kind: "Deployment"
metadata:
  namespace: "monitoring"
  name: "grafana-deploy"
  labels:
    app: "grafana"

spec:
  replicas: 1
  selector:
    matchLabels:
      app: "grafana"
  template:
    metadata:
      labels:
        app: "grafana"
    spec:
      volumes:
        - name: "grafana-storage"
          persistentVolumeClaim:
            claimName: "grafana-pvc"

        - name: "grafana-datasources"
          configMap:
            name: "grafana-datasources"

      containers:
        - name: "grafana"
          image: "grafana/grafana:9.1.6"
          ports:
            - containerPort: 3000
          volumeMounts:
            - name: "grafana-storage"
              mountPath: "/var/lib/grafana"

            - name: "grafana-datasources"
              mountPath: "/etc/grafana/provisioning/datasources"

---
apiVersion: "v1"
kind: "Service"
metadata:
  namespace: "monitoring"
  name: "grafana"

spec:
  selector:
    app: "grafana"
  type: "LoadBalancer"
  ports:
    - name: "http"
      protocol: "TCP"
      port: 3000
      targetPort: 3000
