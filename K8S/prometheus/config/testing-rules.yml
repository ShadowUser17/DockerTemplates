groups:
  - name: "Prometheus testing rules"
    rules:
      - alert: "Prometheus target missing"
        expr: "up == 0"
        for: "1m"
        labels:
          severity: "critical"
        annotations:
          summary: "Prometheus target missing (instance {{ $labels.instance }})"
          description: "A Prometheus target has disappeared. An exporter might be crashed.\nValue: {{ $value }}\nLabels: {{ $labels }}"

      - alert: "Prometheus target empty"
        expr: 'prometheus_sd_discovered_targets == 0'
        for: "1m"
        labels:
          severity: "critical"
        annotations:
          summary: "Prometheus target empty (instance {{ $labels.instance }})"
          description: "Prometheus has no target in service discovery.\nValue: {{ $value }}\nLabels: {{ $labels }}"

      - alert: "Prometheus target scrape duplicate"
        expr: 'increase(prometheus_target_scrapes_sample_duplicate_timestamp_total[5m]) > 0'
        for: "1m"
        labels:
          severity: "warning"
        annotations:
          summary: "Prometheus target scrape duplicate (instance {{ $labels.instance }})"
          description: "Prometheus has many samples rejected due to duplicate timestamps but different values.\nValue: {{ $value }}\nLabels: {{ $labels }}"
