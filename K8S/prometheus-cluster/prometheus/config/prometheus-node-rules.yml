groups:
  - name: "NodeExporter rules"
    rules:
      # - alert: "CPU usage"
      #   expr: '(node_load5 * 100) > 70'
      #   for: "5m"
      #   labels:
      #     severity: "warning"
      #   annotations:
      #     summary: "CPU usage is {{ $value | humanize }} %"
      #     description: "CPU usage of {{ $labels.instance }} is {{ $value | humanize }} %"
      #     fingerprint: "NodeExporter (Instance: {{ $labels.instance }})"

      # - alert: "CPU usage"
      #   expr: '(node_load5 * 100) > 85'
      #   for: "5m"
      #   labels:
      #     severity: "error"
      #   annotations:
      #     summary: "CPU usage is {{ $value | humanize }} %"
      #     description: "CPU usage of {{ $labels.instance }} is {{ $value | humanize }} %"
      #     fingerprint: "NodeExporter (Instance: {{ $labels.instance }})"

      - alert: "Memory usage"
        expr: 'floor(node_memory_MemFree_bytes / 1024 / 1024) < 1024'
        for: "5m"
        labels:
          severity: "warning"
        annotations:
          summary: "Available memory is {{ $value | humanize }} MB"
          description: "Available memory of {{ $labels.instance }} is {{ $value | humanize }} MB"
          fingerprint: "NodeExporter (Instance: {{ $labels.instance }})"

      - alert: "Memory usage"
        expr: 'floor(node_memory_MemFree_bytes / 1024 / 1024) < 512'
        for: "5m"
        labels:
          severity: "error"
        annotations:
          summary: "Available memory is {{ $value | humanize }} MB"
          description: "Available memory of {{ $labels.instance }} is {{ $value | humanize }} MB"
          fingerprint: "NodeExporter (Instance: {{ $labels.instance }})"

      - alert: "Disk usage"
        expr: 'floor(node_filesystem_free_bytes{fstype="ext4"} / 1024 / 1024) < 5120'
        for: "5m"
        labels:
          severity: "warning"
        annotations:
          summary: "Available disk space is {{ $value | humanize }} MB"
          description: "Available disk space of {{ $labels.mountpoint }} is {{ $value | humanize }} MB"
          fingerprint: "NodeExporter (Instance: {{ $labels.instance }}) (Disk: {{ $labels.mountpoint }})"

      - alert: "Disk usage"
        expr: 'floor(node_filesystem_free_bytes{fstype="ext4"} / 1024 / 1024) < 2048'
        for: "5m"
        labels:
          severity: "error"
        annotations:
          summary: "Available disk space is {{ $value | humanize }} MB"
          description: "Available disk space of {{ $labels.mountpoint }} is {{ $value | humanize }} MB"
          fingerprint: "NodeExporter (Instance: {{ $labels.instance }}) (Disk: {{ $labels.mountpoint }})"
