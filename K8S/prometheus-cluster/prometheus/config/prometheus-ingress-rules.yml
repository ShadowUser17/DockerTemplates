groups:
  - name: "Kubernetes Ingress rules"
    rules:
      - alert: "Nginx High HTTP 4XX Error Rate"
        expr: 'sum(rate(nginx_ingress_controller_requests{status=~"^4.."}[1m])) / sum(rate(nginx_ingress_controller_requests[1m])) * 100 > 5'
        for: "2m"
        labels:
          severity: "critical"
        annotations:
          summary: 'Nginx high HTTP 4xx error rate (instance {{ $labels.instance }})'
          description: "Too many HTTP requests with status 4xx (> 5%).\nValue: {{ $value }}\nLabels: {{ $labels }}"

      - alert: "Nginx High HTTP 5XX Error Rate"
        expr: 'sum(rate(nginx_ingress_controller_requests{status=~"^5.."}[1m])) / sum(rate(nginx_ingress_controller_requests[1m])) * 100 > 5'
        for: "2m"
        labels:
          severity: "critical"
        annotations:
          summary: "Nginx high HTTP 5xx error rate (instance {{ $labels.instance }})"
          description: "Too many HTTP requests with status 5xx (> 5%).\nValue: {{ $value }}\nLabels: {{ $labels }}"
