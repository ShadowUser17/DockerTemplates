apiVersion: "v1"
kind: "Pod"
metadata:
    name: "plg-stack-pod"

spec:
    restartPolicy: "Never"
    volumes:
    - name: "promtail-storage"
      hostPath:
        path: "./promtail-data"
        type: "DirectoryOrCreate"

    - name: "grafana-storage"
      hostPath:
        path: "./grafana-data"
        type: "DirectoryOrCreate"

    containers:
    - name: "promtail"
      image: "docker.io/grafana/promtail:2.4.2"
      command:
        - "-config.file=/etc/promtail/config.yml"
      volumeMounts:
      - name: "promtail-storage"
        mountPath: "/var/log"
        readOnly: true

    - name: "loki"
      image: "docker.io/grafana/loki:2.4.2"
      command:
        - "-config.file=/etc/loki/local-config.yaml"
      ports:
      - containerPort: 3100
        hostPort: 3100
        protocol: "TCP"

    - name: "grafana"
      image: "docker.io/grafana/grafana:8.4.3"
      volumeMounts:
      - name: "grafana-storage"
        mountPath: "/var/lib/grafana"
        readOnly: false
      ports:
      - containerPort: 3000
        hostPort: 3000
        protocol: "TCP"
